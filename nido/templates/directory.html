{% extends "base.html" %}
{% block title %}{{current_user.community.name}} Directory{% endblock %}
{% block body_id %}directory{% endblock %}
{% block body %}
    <main>
        <h1>{{current_user.community.name}} Directory</h1>
        <details>
            <summary>Display Options</summary>
            <form method="GET">
                <input type="hidden" name="p" value="{{listings_page.page}}"/>
                <label>Hide Vacant Units
                <input type="checkbox" name="hide_vacant"
                {% if hide_vacant %}checked{% endif %}/>
                </label>
                <button>Refresh</button>
            </form>
        </details>
        <table>
            <thead><tr>
                <th>Unit</th>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
            </tr></thead>
            {% for listing in listings_page.items %}
            {% if not listing.occupants and hide_vacant %}
            {% else %}
            <tr>
                <td rowspan="{{listing.occupants|count or 1}}">
                {% if show_street %}
                {{listing.street}}<br/>
                {% endif %}
                {% if listing.unit_no %}
                {{listing.unit_no}}
                {% endif %}
                </td>
            {% if listing.occupants %}
                {% for resident in listing.occupants %}
                <td>{{resident.personal_name}} {{resident.family_name}}</td>
                <td>{{resident.phone or ""}}</td>
                <td>{{resident.email or ""}}</td>
                {% if not loop.last %}
                </tr>
                <tr>
                {% endif %}
                {% endfor %}
            {% else %}
                <td colspan="3">Vacant</td>
            {% endif %}
            </tr>
            {% endif %}
            {% endfor %}
        </table>
        {% if listings_page.pages > 1 %}
        <nav>
            {% if listings_page.has_prev %}
            <a href="{{url_for('.directory_page',
                p=listings_page.page-1,
                show_photos=show_p,
                hide_vacant=hide_vacant)}}">Previous Page</a>
            {% endif %}
            {% if listings_page.has_next %}
            <a href="{{url_for('.directory_page',
                p=listings_page.page+1,
                show_photos=show_p,
                hide_vacant=hide_vacant)}}">Next Page</a>
            {% endif %}
        </nav>
        {% endif %}
    </main>
{% endblock %}
